###############################################################################################################################################
##
## This file is intended to track bugs (both identified, and fixed) within OHME.
##
###############################################################################################################################################

##--------------------------------
##
## OHME V1 Bugs
##
##--------------------------------

1. Few HRUs are defined a FORESTED Land Use Class and GRASS Vegetation Class, and few are defined as FORESTED Land Use Class and SHRUBLAND Vegetation Class. The reason for this is likely an artifact of the adjustments made following HRU definition to account for Residual / Natural land bases.
  - This is a result of "FORESTED" being the most common land use type (which consists of FORESTED, CONFIEROUS, BROADLEAF, etc. vegetation types) and GRASS (or SHRUBLAND) being only slightly less. Therefore, FORESTED makes up the most land use, but consists of multiple vegetation types, whereas GRASS (or SHRUBLAND) represents the largest vegetation type.
  - The number of HRUs where this is case is insignifcant within the watershed and this issue is not expected to significantly alter results.
  - The HRU definition process should be reviewed for these unique cases.
  
2. Within the "pure" HBV-EC model configuration, :LakeStorage is used to move all precipitation that falls onto LAKE HRUs into a storage compartment.
The "pure" HBV-EC model configuration uses SOIL[2] as this storage compartment. Based on a recommendation from James Craig, this component of the model was removed since it's physical representation is dubious. Precipitation on LAKE HRUs is not added directly to the Surface Water store.

In addition, the "pure" HBV-EC model configuration also has a :LakeEvaporation term to evaporate water from the above storage components (i.e., SOIL[2]). Due to the poor physical representation of this process, coupled with the removal of the :LakeStorage term, :LakeEvaporation was removed from the HBV-EC configuration used in OHME V1.

These adjustments result in large mass balance errors reported for watersheds that have one or more reservoirs present. It was traced to originate in the cumulative loss term within the reservoir mass balance. James Craig advised that this is likely not an issue with the model itself, but the mass balance calculations/checks performed by Raven. However, additional QAQC by James is required.

    *** THIS BUG HAS BEEN FIXED BY JAMES *** NO CHANGES TO HYDROGRAPHS WAS OBSERVERVED ***

3. Under residual streamflows (i.e., the inclusion of water demand from the OWDM and other diversions from the custom-timeseries), the Channel Storage compartment is observed to fill up. James Craig confirmed that this is an error in the mass balance calculations within Raven and will be fixed in due course.

    *** JAMES IS AWARE OF THIS BUG AND WILL FIX IN DUE COURSE ***

4. Update plotting functions to respect disabled subbasins is they are reservoirs. Right now, an error is thrown if there is a disabled subbasin that is a reservoir, because no column exists. Therefore, Powers Creek reservoir plots always fail since Tadpole Lake is permanently disabled. Include a simple if/else to only plot what is there.

5. Update plotting functions to correctly plot subbasin averaged SWE. Currently, this fails in Trout Creek since there are two subbasins with the same Snow_Course manually entered (2F01A) - this refers to LCTN_ID 2F01 and 2F01A. When plotting subbasin average, as well as the watershed name on HRU-average SWE results, this results in zero matches when finding the watershed/subbasin. This is because the command is looking for unique matches of all.snow.courses.included within the snow.course.locations object; however, 2F01 does not exist here (2F01A exists twice). This update should either be made in the subbasin_codes.csv and snow-course-locations-model-domain.csv OR update to use LCTN_ID rather than Snow_Course within the subset command. The snow data ingested into Raven is correct; this appears to only be an error in the plotting function.

    *** THIS BUG HAS BEEN FIXED AND TESTED ON TROUT CREEK WATERSHED - CONTINUED TESTING IS REQUIRED ***